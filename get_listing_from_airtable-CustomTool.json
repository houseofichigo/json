{
  "name": "get_listing_from_airtable",
  "description": "Retrieve listing from airtable",
  "color": "linear-gradient(rgb(215,107,88), rgb(249,183,163))",
  "iconSrc": "",
  "schema": "[]",
  "func": "const fetch = require('node-fetch');\n\n// Return already saved listing detials, if exists\nconst savedListingDetails = $flow.state.listing_info\nif(savedListingDetails?.length){\n  console.log(\"SAVED LISTING DETAILS RETURNED!!!!\")\n  return savedListingDetails\n}\n\n// Replace with your Airtable details\nconst baseId = 'appjvcjxVklJPf01y';\nconst tableName = 'tblPN2vtFyKbwHXj3';\nconst recordId = $vars.listing_id\nconst apiKey = $vars.airtable_api_key;\n\n// Construct the Airtable API URL for the individual record\nconst url = `https://api.airtable.com/v0/${baseId}/${encodeURIComponent(tableName)}/${recordId}`;\nconst options = {\n    method: 'GET',\n    headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${apiKey}`\n    }\n};\n\nconsole.log(\"AIRTABLE URL :\", url)\n\ntry {\n    const response = await fetch(url, options);\n    const parsedResponse = await response.json();\n\n    console.log(\"Fetched Record: \", parsedResponse);\n\n    if (!parsedResponse?.id) {\n        return \"Record not found. Please check the record ID or try again later.\";\n    }\n\n    const responseFields = parsedResponse?.fields\n    const finalResponse = {\n      \"name\": responseFields['Name'],\n      \"finance\": responseFields['Finance'],\n      \"additional_details\": responseFields['Additional'],\n      \"interior\": responseFields['Interior'],\n      \"external\": responseFields['External'],\n      \"status\": responseFields['Status'],\n      \"location\": responseFields['Location'],\n      \"nearby_schools\": responseFields['Schools Nearby'],\n      \"price\": responseFields['Price'],\n    }\n\n    return JSON.stringify(finalResponse); // Returning the individual record in JSON format\n} catch (error) {\n    console.error(\"Error fetching the record from Airtable:\", error);\n    return \"An error occurred while fetching the record from Airtable.\";\n}\n"
}